<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>BigBlobby: BigBlobby</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="BigBlobbyIcon-32x32.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">BigBlobby
   &#160;<span id="projectnumber">0.7</span>
   </div>
   <div id="projectbrief">Qt GUI Front-End for CCV 1.3</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">BigBlobby </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The BigBlobby GUI was written using the open source Qt framework (Qt 4.7.3) (<a href="http://qt-project.org">http://qt-project.org</a>), and has been placed in front of the existing CCV 1.3 program with only minimal modifications to the existing CCV code. The original CCV 1.3 GUI used GLUT (OpengGL Utilities Library) as a GUI. GLUT was only intended as a very basic GUI for OpenGL tutorials, and does not have many of the advanced features of a professional GUI framework such as Qt. In particular, the GLUT GUI for CCV is not resizable, and does not have any kind of zoom control for the images it displays. While writing BigBlobby, those kind of features were fairly straight-forward to implement with the Qt framework, along with a set of menu controls and spin boxes that are synchronized with sliders. </p>
<p>The BigBlobby GUI should also be relatively easy to modify in the future because it uses Qt Designer (<a href="http://qt-project.org/doc/qt-4.8/designer-to-know.html">http://qt-project.org/doc/qt-4.8/designer-to-know.html</a>). Qt Designer is a visual GUI creation tool that allows a developer to drag-and-drop widgets (buttons, sliders, spin boxes, labels, text areas, menus, dockable panels, etc.) to rapidly create a sophisticated GUI. Like CCV and Qt, BigBlobby is distributed under the GNU Lesser General Public License version 2.1, so you are free to modify and redistribute BigBlobby. </p>
<p>Currently, the BigBlobby source code is built with Visual Studio 2008 for C++, and only runs on the Windows operating system. To build BigBlobby with Visual Studio 2008, you must first install the Qt 4.7.3 (or higher) library from <a href="http://qt-project.org">http://qt-project.org</a>. You should also install the Qt Visual Studio Add-in. </p>
<h2>Overview of the BigBlobby GUI</h2>
<p>When the program starts up, the main() function in <a class="el" href="main_8cpp_source.html">main.cpp</a> creates an instance of the QApplication class (of the Qt framework) and an instance of the BigBlobby class. BigBlobby is called on to load general program settings from an XML file and to start a timer that runs the frame calls for blob detection. BigBlobby is then asked to show the main window of the GUI before the exec() function of the QApplication is called to start the Qt event loop. The BigBlobby class itself is fairly simple. Its primary responsibilities are to create an instance of the main window of the GUI, BlobMainWindow, and to create the timer object that is used to repeatedly call on the frame() function of the BlobMainWindow. </p>
<p>An overview of the GUI and blob detection classes created by the BlobMainWindow is shown in the UML class diagram of <b>Figure 1</b>. In UML notation, a line with an arrowhead indicates an important association between 2 classes, while a line with a solid black diamond at one end indicates an ownership type of association. For example, BigBlobby is the owner of the BlobMainWindow, which is in turn the owner of SourceGLWidget, which is in turn the owner of the CoreVision class that does the actual blob detection by calling on CCV code. </p>
<div class="image">
<img src="uml/BigBlobby.png"  alt="UML for BigBlobby GUI"/>
</div>
 <center><h3>Figure 1. UML Diagram for BigBlobby GUI Classes</h3>
</center><center></center><p>Only classes written specifically for the BigBlobby program are shown in <b>Figure 1</b>. Classes belonging to the Qt framework are not shown, as they would be too numerous. Important inheritance relationships to be aware of are that BlobMainWindow is a subclass of the Qt QMainWindow class, and the SourceGLWidget, FilterGLWidget, and CalibrationGLWidget classes are all subclasses of the Qt QGLWidget class, which gives them access to OpenGL rendering routines. The SourceGLWidget class that owns the CoreVision object is used as a surface to draw the video camera Source image shown in the GUI, while the final Tracked image is drawn on a simpler FilterGLWidget, as are the Background, Smoothing, Highpass, and Amplify images. </p>
<h3>Access to CCV Code</h3>
<p>The central class in CCV is ofxNCoreVision. Its update() function, which is called in a continuous loop, obtains the camera image and hands it over to a ProcessFilters object for processing. The processed image is then given to a ContourFinder object, which in turn is handed over to a BlobTracker object. Finally, blobs found by the BlobTracker are handed over to a TUIO object for broadcasting. This order of operations is summarized in <b>Figure 2</b>. </p>
<div class="image">
<img src="uml/ofxNCoreVision.png"  alt="Order of CCV Operations"/>
</div>
 <center> <h3>Figure 2. Order of Operations in the CCV ofxNCoreVision::update() Function</h3>
</center><center> </center><p>Surprisingly, the ofxNCoreVision class also creates the GLUT GUI (class ofxGui), and sets it up, rather than the other way around. For the purpose of replacing the GUI (by using Qt instead of GLUT), it would have been better if the ofxGui knew about ofxNCoreVision, but ofxNCoreVision did not know anything about the GLUT GUI code. Because of this issue, to use a Qt framework GUI, it was necessary to duplicate the ofxNCoreVision class (renamed as <a class="el" href="classblob_core_1_1_core_vision.html" title="Manages the CCV (Community Core Vision) classes needed for detecting blobs resulting from fingertips ...">blobCore::CoreVision</a>), and weed out GLUT GUI code, including the ofxNCoreVision::setUpControls() and ofxNCoreVision::handleGui() functions found in the CCV gui.h file. </p>
<p>On a related issue, the CCV ProcessFilters.h file contains a single draw() function that calls on each image (Source, Background, Smoothing, Highpass, Amplify, and Tracked) to render itself at a specific location on the GLUT GUI (using OpenGL rendering). To allow BigBlobby to use the ProcessFilters class almost "as is", <a class="el" href="classblob_core_1_1_blob_filters.html" title="Provides setter and getter functions for filter parameters along with a draw function for each proces...">blobCore::BlobFilters</a> was created as a subclass of the CCV ProcessFilters class, and functions were added for drawing each image separately. Separate draw() functions allow each image to be rendered on its own Qt QGLWidget object. The <a class="el" href="classblob_core_1_1_blob_filters.html" title="Provides setter and getter functions for filter parameters along with a draw function for each proces...">blobCore::BlobFilters</a> class also provides a convienient place to put public setter and getter functions for filter parameters. </p>
<p>The <a class="el" href="classblob_core_1_1_blob_calibration.html" title="Uses CCV code to calibrate the xy-coordinate system used by a multi-touch surface. ">blobCore::BlobCalibration</a> class of BigBlobby is a slightly modified copy of the CCV Calibration class. The only real issue here is that the keyboard input needed during calibration is now coming from the Qt GUI, not from GLUT. To prevent BlobCalibration from directly knowing anything about the Qt GUI, the keyboard input detected by Qt classes is converted to an enumeration defined in the BigBlobby blobEnums::KeyEnum.h file. That enum is then used as an argument to the <a class="el" href="classblob_core_1_1_core_vision.html" title="Manages the CCV (Community Core Vision) classes needed for detecting blobs resulting from fingertips ...">blobCore::CoreVision</a> keyPressed() function, which passes the info on to the <a class="el" href="classblob_core_1_1_blob_calibration.html" title="Uses CCV code to calibrate the xy-coordinate system used by a multi-touch surface. ">blobCore::BlobCalibration</a> object. The touch events used in the BlobCalibration class are still coming from CCV code, so no changes were needed there. </p>
<p>As an important design decision, the <a class="el" href="classblob_core_1_1_core_vision.html" title="Manages the CCV (Community Core Vision) classes needed for detecting blobs resulting from fingertips ...">blobCore::CoreVision</a> class is intended as the only way that the BigBlobby GUI classes should access CCV code. That is why the CoreVision class provides facade-type functions for controlling its helper classes, rather than exposing any of its helper classes directly. Moreover, to maintain a good separation between view (GUI) and underlying model (blob detection), the CoreVision class and its helper classes should not know anything about the Qt GUI classes or anything else in the Qt library. </p>
<h3>Qt Designer and BlobMainWindow</h3>
<p>The main window of BigBlobby was created primarily using Qt Designer, which comes bundled with the free, open source Qt library. Qt Designer is a visual tool that that allows a developer to drag-and-drop widgets (buttons, labels, spin boxes, sliders, text areas, menus, menu bars, dockable widgets, <em>etc</em>.) to rapidly create a sophisticated GUI. To modify the BigBlobby GUI, use Qt Designer to open the BlobMainWindow.ui file found in the src/blobGui/BlobMainWindow.ui file. The ui file is actually an XML file that will be used by the Qt meta-object compiler to generate a BlobMainWindowUi object. The BlobMainWindow constructor creates an instance of the BlobMainWindowUi object, initializes it, and adds a few more components to it (the custom QGLWidget subclasses used for rendering images). </p>
<p>After creating several additional helper classes, including the SourceGLWidget class that holds the CoreVision object, the very last thing the BlobMainWindow constructor does is create a class called BlobSignalsToSlots. The makeConnections() function of BlobSignalsToSlots is responsible for nearly all of the connections from GUI components (buttons, sliders, spin boxes, menu options, <em>etc</em>.) to slots (public functions) on BlobMainWindow or one of its helper classes. The Qt "signals to slots" concept is similar to the idea of listeners in Java or other languages, but tends to be a bit more flexible, as any signal can be connected to any slot, as long as the type and number of arguments is the same (see the Qt documentation for details). </p>
<p>The BlobMainWindow also creates a few helper classes for responding to the View menu at the top of the GUI. The BlobMainWindowView object contains code for zooming in on either the main panel (Source and Tracked images) or the filters panel (Background, Smoothing, Highpass, and Amplify images). Initially, I placed the zooming code in the BlobMainWindow itself, but the class was simply getting too large, so all zooming related code was moved into BlobMainWindowView. To allow the user to select a custom zoom size not found in the View menu, there is a CustomZoomDialog class, which also happens to use Qt Designer to create the actual UI object. There is also a Help class that responds to the Help menu by opening an "About..." box with program credits (including CCV and Qt URLs) or opening a web browser to online help for BigBlobby/CCV. The Help class can also provide info on the current machine's GPU and OpenGL version. BlobMainWindow also creates an instance of BlobXmlSettings for operating the XML reader/writer classes that are discussed right below. </p>
<h3>XML File Input/Output/Validation and Error Handling</h3>
<p>When the BigBlobby/CCV program first starts up, many of the program settings, including all of the numbers shown in the GUI, are read in from an XML configuration file, data/settings/DefaultBlobParams.xml. When the program is terminated by selecting Quit from the File menu or clicking on the close box of the main window, the current program settings are automatically written back out to the same file. Because this file can be hand edited, there is an obvious potential for errors. The exception classes shown in <b>Figure 3</b> are for handling those errors. </p>
<div class="image">
<img src="uml/BlobExceptions.png"  alt="UML for Exception Classes"/>
</div>
 <center><h3>Figure 3. UML Diagram for Exception Classes</h3>
</center><center></center><p>The XML reader and writer classes, BlobParamsXmlReader and BlobParamsXmlWriter, are operated by the BlobXmlSettings class, which is a helper class for BlobMainWindow (see <b>Figure 1</b>). If the DefaultBlobParams.xml file is read successfully, a BlobParamsValidator object is handed back by the XML reader, and the parameters held by the validator object will be used to update both the GUI and the underlying CoreVision object that does the blob detection. When the program closes normally, the BlobXmlSettings object will obtain a validator object with the current CoreVision settings and pass it to the XML writer. In this case, the validator is simply a convenient way to pass around a bundle of parameters, no validation needs to be performed. </p>
<p>If the XML reader, writer, or validator throws an exception, the exception will be caught by a try-catch block in BlobXmlSettings, and a dialog box will be used to inform the user of the problem. If the exception was thrown by the reader or validator when the program first opens, a default BlobXmlSettings object with hard-coded "factory" default settings will be used after warning the user. The user will also be informed that the File menu has an option to Exit (without saving) so that the DefaultBlobParams.xml file does not get modified. This Exit (without saving) option is provided in case the user wants to fix the problem by hand editing, rather than accept the "factory" default settings. </p>
<p>The classes shown in <b>Figure 3</b> are "structured" exceptions, meaning that they store individual fields of information that can be presented to the user (in addition to the short message that all exceptions usually hold). If a BlobXmlReaderException is thrown, the dialog box will include the line number and column number of the error along with the filename and a message as to the nature of the error. If the validator throws an UnknownXmlTagException, the dialog box will include the name of the unrecognized XML tag along with the name of its parent tag. If the validator finds an obviously illegal value, a BlobParamsException is thrown, and the dialog box will show the illegal value and a statement on the expected value. In this context, examples of "obviously illegal" values would be something other than "true" or "false" where a boolean value is expected, or a negative number where only a positive integer or zero would make sense (imageTheshold, maxNumberBlobs, or any of the numeric filter settings). If a FileNotFound exception is thrown, the dialog box will inform the user of the path and name of the missing file. </p>
<h3>Where Exceptions are Not Used</h3>
<p>As soon as a screen calibration is finished by the CCV calibration code, the CCV CalibrationUtils class immediately saves the results out to an XML file, data/settings/calibration/calibration.xml. This XML file is also read in by the CCV CalibrationUtils class when the BlobCalibration class is initialized at program start up. This file is not intended to be hand-edited, and none of the error handling discussed above is applied. </p>
<p>For the PS3 (Play Station 3) camera, the destructor of the CCV ofxPS3 class saves out settings such as exposure and gain to the data/settings/cameras/cameras.xml file. This file is also read in by the ofxPS3 initialization routine. This is handled by the PS3 driver code, and does not appear to have any exception handling. Looking through the CCV code, there appear to be no try-catch blocks anywhere, except for an empty catch block in the ofAppGlutWindow.cpp file, and a few catch blocks in the OpenFrameworks ofSoundStream.cpp file that print error messages, but ofSoundStream.cpp does not appear to be used by CCV. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Aug 7 2013 19:11:55 for BigBlobby by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.4
</small></address>
</body>
</html>
